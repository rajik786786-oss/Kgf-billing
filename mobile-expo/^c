import React, { useState } from 'react';
import { View, Text, TextInput, Button, FlatList } from 'react-native';
import * as Print from 'expo-print';
import * as FileSystem from 'expo-file-system';

export default function Home() {
  const [productName, setProductName] = useState('');
  const [price, setPrice] = useState('');
  const [discount, setDiscount] = useState('');
  const [items, setItems] = useState([]);

  const addItem = () => {
    if (!productName || !price) return;

    const finalPrice =
      parseFloat(price) - (parseFloat(discount) || 0);

    const newItem = {
      id: Date.now().toString(),
      name: productName,
      price: finalPrice.toFixed(2),
    };

    setItems([...items, newItem]);
    setProductName('');
    setPrice('');
    setDiscount('');
  };

  const generatePDF = async () => {
    const html = `
      <html>
        <body>
          <h1>KGF Men's Wear Invoice</h1>
          <hr />
          ${items
            .map(
              (item) =>
                `<p>${item.name} — ₹${item.price}</p>`
            )
            .join('')}
        </body>
      </html>
    `;

    const { uri } = await Print.printToFileAsync({ html });

    const dest = FileSystem.documentDirectory + `invoice_${Date.now()}.pdf`;

    await FileSystem.moveAsync({
      from: uri,
      to: dest,
    });

    alert('Invoice saved: ' + dest);
  };

  return (
    <View style={{ padding: 20 }}>
      <TextInput
        placeholder="Product Name"
        value={productName}
        onChangeText={setProductName}
        style={{ borderWidth: 1, padding: 10, marginBottom: 10 }}
      />

      <TextInput
        placeholder="Price"
        keyboardType="numeric"
        value={price}
        onChangeText={setPrice}
        style={{ borderWidth: 1, padding: 10, marginBottom: 10 }}
      />

      <TextInput
        placeholder="Discount"
        keyboardType="numeric"
        value={discount}
        onChangeText={setDiscount}
        style={{ borderWidth: 1, padding: 10, marginBottom: 10 }}
      />

      <Button title="Add Item" onPress={addItem} />

      <FlatList
        data={items}
        renderItem={({ item }) => (
          <Text style={{ marginTop: 10 }}>
            {item.name} — ₹{item.price}
          </Text>
        )}
        keyExtractor={(item) => item.id}
      />

      <Button
        title="Generate Invoice PDF"
        onPress={generatePDF}
      />
    </View>
  );
}
